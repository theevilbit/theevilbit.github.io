<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Beyond the good ol&#39; LaunchAgents - 2 - iTerm2 startup · theevilbit blog
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Csaba Fitzl">
<meta name="description" content="
This is part 2 in the series of &ldquo;Beyond the good ol&rsquo; LaunchAgents&rdquo;, where I try to collect various persistence techniques for macOS. For more background check the introduction.

If the first part was about Terminal and shell profiles, it&rsquo;s worth to mention iTerm2, which is a popular Terminal alternative on macOS. It&rsquo;s being used by many people, especially power users.
When we start iTerm2 it starts the same shell environment as Terminal,  and thus the same startup files apply here as well. However this application has an additional way to execute code.">
<meta name="keywords" content="blog,macos,apple,security,vulnerability,exploit,cve">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Beyond the good ol&#39; LaunchAgents - 2 - iTerm2 startup">
  <meta name="twitter:description" content="This is part 2 in the series of “Beyond the good ol’ LaunchAgents”, where I try to collect various persistence techniques for macOS. For more background check the introduction.
If the first part was about Terminal and shell profiles, it’s worth to mention iTerm2, which is a popular Terminal alternative on macOS. It’s being used by many people, especially power users.
When we start iTerm2 it starts the same shell environment as Terminal, and thus the same startup files apply here as well. However this application has an additional way to execute code.">

<meta property="og:url" content="https://theevilbit.github.io/beyond/beyond_0002/">
  <meta property="og:site_name" content="theevilbit blog">
  <meta property="og:title" content="Beyond the good ol&#39; LaunchAgents - 2 - iTerm2 startup">
  <meta property="og:description" content="This is part 2 in the series of “Beyond the good ol’ LaunchAgents”, where I try to collect various persistence techniques for macOS. For more background check the introduction.
If the first part was about Terminal and shell profiles, it’s worth to mention iTerm2, which is a popular Terminal alternative on macOS. It’s being used by many people, especially power users.
When we start iTerm2 it starts the same shell environment as Terminal, and thus the same startup files apply here as well. However this application has an additional way to execute code.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="beyond">
    <meta property="article:published_time" content="2021-03-16T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-03-16T00:00:00+00:00">
    <meta property="article:tag" content="Macos">
    <meta property="article:tag" content="Persistence">
    <meta property="article:tag" content="Beyond">




<link rel="canonical" href="https://theevilbit.github.io/beyond/beyond_0002/">


<link rel="preload" href="https://theevilbit.github.io/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://theevilbit.github.io/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://theevilbit.github.io/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="https://theevilbit.github.io/css/coder.min.4410e480b3bad72c110a96b56e5aa8c36c24a0f3735b278818123b0fa4393fcd.css" integrity="sha256-RBDkgLO61ywRCpa1blqow2wkoPNzWyeIGBI7D6Q5P80=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="https://theevilbit.github.io/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="https://theevilbit.github.io/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="https://theevilbit.github.io/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://theevilbit.github.io/images/apple-touch-icon.png">

<link rel="manifest" href="https://theevilbit.github.io/site.webmanifest">
<link rel="mask-icon" href="https://theevilbit.github.io/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://theevilbit.github.io/">
      theevilbit blog
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/posts/">Posts</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/talks/">Talks and Workshops</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/shield/">Shield.app</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/beyond/">Beyond good ol&#39; LaunchAgents</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/tags/">Tags</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://theevilbit.github.io/beyond/beyond_0002/">
          Beyond the good ol&#39; LaunchAgents - 2 - iTerm2 startup
        </a>
      </h1>
    </header>

    <blockquote>
<p>This is part 2 in the series of &ldquo;Beyond the good ol&rsquo; LaunchAgents&rdquo;, where I try to collect various persistence techniques for macOS. For more background check the <a href="https://theevilbit.github.io/beyond/beyond_intro/"  class="external-link" target="_blank" rel="noopener">introduction</a>.</p>
</blockquote>
<p>If the first part was about <code>Terminal</code> and shell profiles, it&rsquo;s worth to mention <a href="https://iterm2.com/"  class="external-link" target="_blank" rel="noopener">iTerm2</a>, which is a popular Terminal alternative on macOS. It&rsquo;s being used by many people, especially power users.</p>
<p>When we start <code>iTerm2</code> it starts the same shell environment as <code>Terminal</code>,  and thus the same startup files apply here as well. However this application has an additional way to execute code.</p>
<p><img src="https://theevilbit.github.io/images/beyond/beyond_0002_0.png" alt="iTerm2 Profile Preferences"></p>
<p>In the Profile settings, there is an option, which is <strong>Send text at start</strong>. This is essentially a command we can run when someone starts up iTerm2. This is saved in iTerm2&rsquo;s preferences, which can be found at <code>~/Library/Preferences/com.googlecode.iterm2.plist</code>.</p>
<p>This is a binary PLIST, and we can use <code>plutil</code> to convert it to XML format.</p>
<pre tabindex="0"><code>csaby@mac ~ % plutil -convert xml1 ~/Library/Preferences/com.googlecode.iterm2.plist -o - | grep -A 1 &#34;Initial Text&#34;
			&lt;key&gt;Initial Text&lt;/key&gt;
			&lt;string&gt;whoami&lt;/string&gt;
--
			&lt;key&gt;Initial Text&lt;/key&gt;
			&lt;string&gt;uname&lt;/string&gt;
</code></pre><p>The command is saved under the <strong>Initail Text</strong> key, and there can be multiple for different profiles. We can also use the <code>defaults</code> command to get this data.</p>
<pre tabindex="0"><code>csaby@mac ~ % defaults read com.googlecode.iterm2 | grep Initial
            &#34;Initial Text&#34; = whoami;
            &#34;Initial Text&#34; = uname;
</code></pre><p>Beyond persisting, <code>iTerm2</code> can have plenty of TCC exception if it receives user consent.</p>
<pre tabindex="0"><code>Executable=/Applications/iTerm.app/Contents/MacOS/iTerm2
Identifier=com.googlecode.iterm2
Format=app bundle with Mach-O universal (x86_64 arm64)
CodeDirectory v=20500 size=140993 flags=0x10000(runtime) hashes=4395+7 location=embedded
Signature size=8978
Timestamp=2021. Feb 8. 7:27:16
Info.plist entries=51
TeamIdentifier=H7V7XYVQ7D
Runtime Version=11.1.0
Sealed Resources version=2 rules=13 files=318
Internal requirements count=1 size=216
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;!DOCTYPE plist PUBLIC &#34;-//Apple//DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;
&lt;plist version=&#34;1.0&#34;&gt;
&lt;dict&gt;
	&lt;key&gt;com.apple.security.automation.apple-events&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.cs.allow-jit&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.device.audio-input&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.device.camera&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.personal-information.addressbook&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.personal-information.calendars&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.personal-information.location&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.personal-information.photos-library&lt;/key&gt;
	&lt;true/&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre><p>As we can find in its entitlements, it can have access to camera, microphone, and several sensitive folders. Thus if access was granted by the user, we could access the same information with our persisted command.</p>
<p>Beyond this iTerm2 supports various auto launch scripts.</p>
<p>Scripts placed inside <code>~/Library/Application Support/iTerm2/Scripts/AutoLaunch</code> will be automatically launched upon starting iTerm. More information: <a href="https://iterm2.com/python-api/tutorial/daemons.html"  class="external-link" target="_blank" rel="noopener">Daemons — iTerm2 Python API 0.26 documentation</a></p>
<p>The file <code>~/Library/Application Support/iTerm2/Scripts/AutoLaunch.scpt</code> is also checked at startup, and it will be executed. This should be an Apple Script. More information: <a href="https://iterm2.com/documentation-scripting.html"  class="external-link" target="_blank" rel="noopener">Scripting - Documentation - iTerm2 - macOS Terminal Replacement</a></p>

  </article>
</section>

  

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2019 -
    
    2025
     Csaba Fitzl 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="https://theevilbit.github.io/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
