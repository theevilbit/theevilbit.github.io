<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  macOS LPE via the .localized directory · theevilbit blog
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Csaba Fitzl">
<meta name="description" content="This blog is about a vulnerability on macOS which impacts every third party installer if they try to run a privileged command from within the application bundle.
This vulnerability has a very long history, and Apple never managed to properly fix it, and I never got a CVE only a note in the “Additional Recognition” section.

  A Little History
  
    
    Link to heading
  

There is a very long history of this specific bug that I kept reporting to Apple since 2018 (7 years!!). This bug can be exploited when we install third party software on the system. Actually this was my very first vulnerability I submitted to Apple, and my very first macOS talk back in 2019, called macOS - Getting root with benign AppStore apps.">
<meta name="keywords" content="blog,macos,apple,security,vulnerability,exploit,cve">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="macOS LPE via the .localized directory">
  <meta name="twitter:description" content="This blog is about a vulnerability on macOS which impacts every third party installer if they try to run a privileged command from within the application bundle.
This vulnerability has a very long history, and Apple never managed to properly fix it, and I never got a CVE only a note in the “Additional Recognition” section.
A Little History Link to heading There is a very long history of this specific bug that I kept reporting to Apple since 2018 (7 years!!). This bug can be exploited when we install third party software on the system. Actually this was my very first vulnerability I submitted to Apple, and my very first macOS talk back in 2019, called macOS - Getting root with benign AppStore apps.">

<meta property="og:url" content="https://theevilbit.github.io/posts/localized/">
  <meta property="og:site_name" content="theevilbit blog">
  <meta property="og:title" content="macOS LPE via the .localized directory">
  <meta property="og:description" content="This blog is about a vulnerability on macOS which impacts every third party installer if they try to run a privileged command from within the application bundle.
This vulnerability has a very long history, and Apple never managed to properly fix it, and I never got a CVE only a note in the “Additional Recognition” section.
A Little History Link to heading There is a very long history of this specific bug that I kept reporting to Apple since 2018 (7 years!!). This bug can be exploited when we install third party software on the system. Actually this was my very first vulnerability I submitted to Apple, and my very first macOS talk back in 2019, called macOS - Getting root with benign AppStore apps.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-12-05T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-05T00:00:00+00:00">
    <meta property="article:tag" content="Macos">
    <meta property="article:tag" content="Lpe">
    <meta property="article:tag" content="Installer">




<link rel="canonical" href="https://theevilbit.github.io/posts/localized/">


<link rel="preload" href="https://theevilbit.github.io/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://theevilbit.github.io/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://theevilbit.github.io/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="https://theevilbit.github.io/css/coder.min.4410e480b3bad72c110a96b56e5aa8c36c24a0f3735b278818123b0fa4393fcd.css" integrity="sha256-RBDkgLO61ywRCpa1blqow2wkoPNzWyeIGBI7D6Q5P80=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="https://theevilbit.github.io/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="https://theevilbit.github.io/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="https://theevilbit.github.io/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://theevilbit.github.io/images/apple-touch-icon.png">

<link rel="manifest" href="https://theevilbit.github.io/site.webmanifest">
<link rel="mask-icon" href="https://theevilbit.github.io/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://theevilbit.github.io/">
      theevilbit blog
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/posts/">Posts</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/talks/">Talks and Workshops</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/shield/">Shield.app</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/beyond/">Beyond good ol&#39; LaunchAgents</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/tags/">Tags</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://theevilbit.github.io/posts/localized/">
              macOS LPE via the .localized directory
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2025-12-05T00:00:00Z">
                December 5, 2025
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              6-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="https://theevilbit.github.io/categories/blog/">BLOG</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="https://theevilbit.github.io/tags/macos/">Macos</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://theevilbit.github.io/tags/lpe/">Lpe</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://theevilbit.github.io/tags/installer/">Installer</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>This blog is about a vulnerability on macOS which impacts <em>every</em> third party installer if they try to run a privileged command from within the application bundle.</p>
<p>This vulnerability has a very long history, and Apple never managed to properly fix it, and I never got a CVE only a note in the “Additional Recognition” section.</p>
<h2 id="a-little-history">
  A Little History
  <a class="heading-link" href="#a-little-history">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>There is a very long history of this specific bug that I kept reporting to Apple since 2018 (7 years!!). This bug can be exploited when we install third party software on the system. Actually this was my very first vulnerability I submitted to Apple, and my very first macOS talk back in 2019, called <a href="https://theevilbit.github.io/posts/getting_root_with_benign_appstore_apps/"  class="external-link" target="_blank" rel="noopener">macOS - Getting root with benign AppStore apps</a>.</p>
<p>The main idea is that we either redirect the files being installed somewhere else on the system, or by pre-creating the directory structure, we will own the app’s directories and then later we can swap any file. Imagine a software is installing a <code>LaunchDaemon</code> and the related binary is in the application’s directory (as it should be since macOS Sequoia by design). This is OK if the application was installed via a package which was run as root. In that case the folder is owned by root, and no one can modify those binaries anymore. But if we create the app bundle directories first, then we will be able to swap any binary after the installation. I truly believe that this is an Apple problem and third parties should rightfully expect being installed properly, without going the extra mile of verification.</p>
<p>I had four tickets opened for this specific issue. I don’t have the number of the first two, as I opened them via my old company email and those are gone now, but the next two were OE1924072282339, OE1912725854317. The very last one was decided not to be a security issue first but they eventually fixed it in <a href="https://support.apple.com/120950"  class="external-link" target="_blank" rel="noopener">macOS Sonoma</a>. It turned out that it still wasn’t good, you could still race the fact that Apple tried to delete any preexisting directory.</p>
<p>Honestly I gave up at this point, I never got a CVE, nor any reward for this, had to fight every single time to be considered as a vulnerability, so I just <a href="https://www.youtube.com/watch?v=moSFlvxnbgk"  class="external-link" target="_blank" rel="noopener">Let It Go</a> at that point.</p>
<p>Luckily <a href="https://x.com/patch1t"  class="external-link" target="_blank" rel="noopener">Mickey Jin (@patch1t)</a> had more luck, and he got them to fix this properly (kinda), and even got assigned CVE-2025-24099. He wrote about this in his blog post <a href="https://jhftss.github.io/Endless-Exploits/"  class="external-link" target="_blank" rel="noopener">Endless Exploits: The Saga of a macOS Vulnerability Struck Nine Times</a>. The funny thing is that Apple told him the same as they told me, but before his <a href="https://objectivebythesea.org/v7/talks.html"  class="external-link" target="_blank" rel="noopener">OBTS</a> talk, where he planned to publish it, Apple decided to fix it.</p>
<p>So here we are in 2025, with a vulnerability still exploitable 7 years later, although in a different way. We can no longer race the installation process and pre-create the directories. But there is still a way.</p>
<h2 id="meet-localized">
  Meet .localized
  <a class="heading-link" href="#meet-localized">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>I thought that we are finally done with this, until 2025 came and I read a blog post from <a href="https://x.com/p1tsist1p"  class="external-link" target="_blank" rel="noopener">@p1tsist1p</a>. He wrote about a vulnerability in <a href="https://p1tsi.github.io/posts/NordVPN-LPE/"  class="external-link" target="_blank" rel="noopener">NordVPN installer</a> and also the same issue in <a href="https://p1tsi.github.io/posts/MSTeams-LPE/"  class="external-link" target="_blank" rel="noopener">Microsoft Teams installer</a>. The technique he described was new to me, and it had the exact same impact as my original reports, you could own the application bundle directory and replace later any binaries. This was first discovered by Arjen, back in 2017 and there is even a rdar ticket for this, <a href="https://openradar.appspot.com/33005768"  class="external-link" target="_blank" rel="noopener">rdar://33005768: Installer creates .localized directory for application bundle</a>. But what is the issue?</p>
<p>Let’s say we try upgrade or install <code>/Applications/Test.app</code>, but if there is already an application with the same directory name but with a different bundle id, the new application will be installed in <code>/Applications/Test.localized/Test.app</code>. See the problem?</p>
<p>The problem is that when we install an application it expects to be installed in its final location (rightfully I think), but if there is something else with different bundle ID that won’t be deleted and the app will be placed in <code>.localized</code>. Now when the app installs and registers its launch daemon, which executes something from the proper application directory, we will have full control over that. Here is the flow of events:</p>
<ol>
<li>We place an application called <code>Test.app</code> in <code>/Applications</code> with some random bundle ID. We also place our own launch daemon binary what will be registered by the real <code>Test.app</code>.</li>
<li>The user installs <code>Test.app</code>. This will go under <code>/Applications/Test.localized</code> and our app will not be removed.</li>
<li>The <code>Test.app</code> registers its launch daemon.</li>
<li><code>launchd</code> starts the binary specified in the previously registered launch daemon. This will be executed as root.</li>
<li>Since we own the binary we will get root code execution.</li>
</ol>
<p>That’s it.</p>
<p>Here is a video showing this working with an old version of Microsoft Teams.</p>
<video preload="metadata" controls>
    <source
      src="https://theevilbit.github.io/videos/localized/packagekit-localized.mov"
      type="video/mp4"
    >
    Your browser does not support the video element.
  </video>
<!-- raw HTML omitted -->
<p><a href="https://gist.github.com/theevilbit/5994185969e6e36dffc740c4796ea259"  class="external-link" target="_blank" rel="noopener">POC</a></p>
<p>I think this is a problem at Apple side, as you can’t expect <em>ALL</em> third party vendors preparing for this edge case. We, as a security community, can either start reporting issues to every impacted third party vendor, which is not feasible and doesn’t scale, or we can get Apple fixing this.</p>
<p>So because this is an evolution of the issue I kept reporting for 7 years, I submitted a new ticket to Apple, OE110192294822. After 8 months going back and forth I had no luck convincing them that they should fix it. They closed it as “We’re unable to identify a security issue in your report.” and they claim it’s a problem in the installer.</p>
<p>I get that this is not the most exciting LPE, and yes, it does require the user installing a product in order to exploit this, but in enterprise environment these packages will be most likely installed or pushed down via MDM, where user interaction is not really needed, so it can be useful in a red teaming scenario.</p>
<h2 id="recommendation">
  Recommendation
  <a class="heading-link" href="#recommendation">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>If you are third party vendor and reading this:</p>
<ol>
<li>Considering the above please check your installer and if you run any privileged process from your application bundle, then try to do something about this on your end, e.g.:
<ol>
<li>Move it to another location, like <code>/Library/PrivilegedHelpers</code> or anywhere in <code>/Library/</code>.</li>
<li>Ensure during the installation that it goes to the right place. This will be really hard, as there are ton of race condition possibilities.</li>
<li>If you feel like, report this to Apple via <a href="https://security.apple.com/reports"  class="external-link" target="_blank" rel="noopener">Apple Security Reports</a> and you can also refer to my original ticket, OE110192294822</li>
</ol>
</li>
<li>If you are a security researcher:
<ol>
<li>If you find a vulnerable package, and I can assure you there are a ton of these, report it to the vendor, maybe you will also get some bounty.</li>
<li>You can also try convincing Apple, by reporting this via <a href="https://security.apple.com/reports"  class="external-link" target="_blank" rel="noopener">Apple Security Reports</a> and you can also refer to my original ticket, OE110192294822.</li>
</ol>
</li>
</ol>
<h2 id="final-thoughts">
  Final Thoughts
  <a class="heading-link" href="#final-thoughts">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Not really :D</p>

      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2019 -
    
    2025
     Csaba Fitzl 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="https://theevilbit.github.io/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
