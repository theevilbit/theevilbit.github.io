<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Csaba Fitzl">
    
    

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CVE-2022-22655 - TCC - Location Services Bypass"/>
<meta name="twitter:description" content="This is a quick blogpost about a vulnerability I covered in our Black Hat Europe 2022 talk with Wojciech Regula.
In contrary to what people would expect, clients which can access location services are not maintained in one of the TCC databased, but in a separate location, and it&rsquo;s maintained by locationd. This has been also recently covered by Howard Oakley, in his Privacy: what TCC does and doesn’t blogpost."/>

    <meta property="og:title" content="CVE-2022-22655 - TCC - Location Services Bypass" />
<meta property="og:description" content="This is a quick blogpost about a vulnerability I covered in our Black Hat Europe 2022 talk with Wojciech Regula.
In contrary to what people would expect, clients which can access location services are not maintained in one of the TCC databased, but in a separate location, and it&rsquo;s maintained by locationd. This has been also recently covered by Howard Oakley, in his Privacy: what TCC does and doesn’t blogpost." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://theevilbit.github.io/posts/cve-2022-22655/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-02-13T00:00:00+00:00" />


    
      <base href="https://theevilbit.github.io/posts/cve-2022-22655/">
    
    <title>
  CVE-2022-22655 - TCC - Location Services Bypass · theevilbit blog
</title>

    
      <link rel="canonical" href="https://theevilbit.github.io/posts/cve-2022-22655/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://theevilbit.github.io/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    

    
    
    <link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.119.0">
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://theevilbit.github.io/">
      theevilbit blog
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/posts/">Posts</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/talks/">Talks and Workshops</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/shield/">Shield.app</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/beyond/">Beyond good ol&#39; LaunchAgents</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/tags/">Tags</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/about/">About</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">CVE-2022-22655 - TCC - Location Services Bypass</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2023-02-13T00:00:00Z'>
                February 13, 2023
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              2 minutes read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://theevilbit.github.io/categories/blog/">BLOG</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://theevilbit.github.io/tags/macos/">macos</a>
      <span class="separator">•</span>
    <a href="https://theevilbit.github.io/tags/tcc/">tcc</a>
      <span class="separator">•</span>
    <a href="https://theevilbit.github.io/tags/vulnerability/">vulnerability</a>
      <span class="separator">•</span>
    <a href="https://theevilbit.github.io/tags/cve/">cve</a></div>

        </div>
      </header>

      <div>
        <p>This is a quick blogpost about a vulnerability I covered in our <a href="https://www.blackhat.com/eu-22/briefings/schedule/index.html#knockout-win-against-tcc----new-ways-to-bypass-your-macos-privacy-mechanisms-29272">Black Hat Europe 2022 talk</a> with <a href="https://twitter.com/_r3ggi">Wojciech Regula</a>.</p>
<p>In contrary to what people would expect, clients which can access location services are not maintained in one of the TCC databased, but in a separate location, and it&rsquo;s maintained by locationd. This has been also recently covered by Howard Oakley, in his <a href="https://eclecticlight.co/2023/02/10/privacy-what-tcc-does-and-doesnt/">Privacy: what TCC does and doesn’t</a> blogpost.</p>
<p>TCC&rsquo;s location services allowed client list is located inside <code>/var/db/locationd/clients.plist</code>. This file is protected by the Sandbox/TCC, thus we can&rsquo;t modify it, and add new client, even if we have root privileges.</p>
<p>However the <code>/var/db/locationd/</code> directory is not protected from mounting. We can create a custom disk image, with a custom client list, and mount it over the directory. After restarting locationd the new list will take effect. This allows us to bypass locationd TCC protection.</p>
<p>To demonstrate access I used <a href="https://twitter.com/slyd0g">Justin Bui&rsquo;s</a>  <a href="https://github.com/slyd0g/SwiftLiverpool">SwiftLiverpool</a> tool.</p>
<p>The POC, will drop the compiled binary <code>swiftliverpool</code>and grant it access in a custom PLIST file. Then it will create a disk image and mount it over the specified directory. It must be run as root, because only then we can mount over the directory.</p>
<p>In the custom PLIST file the important entry is the following, this is what grants the executable access to location services.</p>
<pre tabindex="0"><code>	&lt;key&gt;com.apple.locationd.executable-&lt;/key&gt;
	&lt;dict/&gt;
	&lt;key&gt;com.apple.locationd.executable-/private/tmp/swiftliverpool&lt;/key&gt;
	&lt;dict&gt;
		&lt;key&gt;Authorized&lt;/key&gt;
		&lt;true/&gt;
		&lt;key&gt;BundleId&lt;/key&gt;
		&lt;string&gt;com.apple.locationd.executable-/private/tmp/swiftliverpool&lt;/string&gt;
		&lt;key&gt;Executable&lt;/key&gt;
		&lt;string&gt;/private/tmp/swiftliverpool&lt;/string&gt;
		&lt;key&gt;Registered&lt;/key&gt;
		&lt;string&gt;/private/tmp/swiftliverpool&lt;/string&gt;
		&lt;key&gt;Requirement&lt;/key&gt;
		&lt;string&gt;cdhash H&#34;39fed059b420f6077761625e2f87b583eae49e88&#34;&lt;/string&gt;
	&lt;/dict&gt;
</code></pre><p>POC:</p>
<p><a href="https://gist.github.com/theevilbit/20b73350b2df757c989949286fe6ca27">CVE-2022-22655 - macOS Location Services Bypass · GitHub</a></p>

      </div>

      <footer>
        


        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
     © 2023
    
       · 
      Blog created by <a href="https://twitter.com/theevilbit">@theevilbit</a>.
    
    
  </section>
</footer>

    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-151008930-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>

</html>
