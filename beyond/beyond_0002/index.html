<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Csaba Fitzl">
    
    

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Beyond the good ol&#39; LaunchAgents - 2 - iTerm2 startup"/>
<meta name="twitter:description" content="This is part 2 in the series of &ldquo;Beyond the good ol&#39; LaunchAgents&rdquo;, where I try to collect various persistence techniques for macOS. For more background check the introduction.
 If the first part was about Terminal and shell profiles, it&rsquo;s worth to mention iTerm2, which is a popular Terminal alternative on macOS. It&rsquo;s being used by many people, especially power users.
When we start iTerm2 it starts the same shell environment as Terminal, and thus the same startup files apply here as well."/>

    <meta property="og:title" content="Beyond the good ol&#39; LaunchAgents - 2 - iTerm2 startup" />
<meta property="og:description" content="This is part 2 in the series of &ldquo;Beyond the good ol&#39; LaunchAgents&rdquo;, where I try to collect various persistence techniques for macOS. For more background check the introduction.
 If the first part was about Terminal and shell profiles, it&rsquo;s worth to mention iTerm2, which is a popular Terminal alternative on macOS. It&rsquo;s being used by many people, especially power users.
When we start iTerm2 it starts the same shell environment as Terminal, and thus the same startup files apply here as well." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://theevilbit.github.io/beyond/beyond_0002/" /><meta property="article:section" content="beyond" />
<meta property="article:published_time" content="2021-03-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-03-16T00:00:00+00:00" />



    
      <base href="https://theevilbit.github.io/beyond/beyond_0002/">
    
    <title>
  Beyond the good ol&#39; LaunchAgents - 2 - iTerm2 startup · theevilbit blog
</title>

    
      <link rel="canonical" href="https://theevilbit.github.io/beyond/beyond_0002/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://theevilbit.github.io/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    

    
    
    <link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.89.2" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://theevilbit.github.io/">
      theevilbit blog
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/posts/">Posts</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/shield/">Shield.app</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/beyond/">Beyond good ol&#39; LaunchAgents</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/tags/">Tags</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/categories/">Categories</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://theevilbit.github.io/about/">About</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Beyond the good ol&#39; LaunchAgents - 2 - iTerm2 startup</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2021-03-16T00:00:00Z'>
                March 16, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              2 minutes read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://theevilbit.github.io/categories/persistence/">persistence</a>
      <span class="separator">•</span>
    <a href="https://theevilbit.github.io/categories/beyond/">beyond</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://theevilbit.github.io/tags/macos/">macos</a>
      <span class="separator">•</span>
    <a href="https://theevilbit.github.io/tags/persistence/">persistence</a>
      <span class="separator">•</span>
    <a href="https://theevilbit.github.io/tags/beyond/">beyond</a></div>

        </div>
      </header>

      <div>
        <blockquote>
<p>This is part 2 in the series of &ldquo;Beyond the good ol' LaunchAgents&rdquo;, where I try to collect various persistence techniques for macOS. For more background check the <a href="https://theevilbit.github.io/beyond/beyond_intro/">introduction</a>.</p>
</blockquote>
<p>If the first part was about <code>Terminal</code> and shell profiles, it&rsquo;s worth to mention <a href="https://iterm2.com/">iTerm2</a>, which is a popular Terminal alternative on macOS. It&rsquo;s being used by many people, especially power users.</p>
<p>When we start <code>iTerm2</code> it starts the same shell environment as <code>Terminal</code>,  and thus the same startup files apply here as well. However this application has an additional way to execute code.</p>
<p><img src="https://theevilbit.github.io/images/beyond/beyond_0002_0.png" alt="iTerm2 Profile Preferences"></p>
<p>In the Profile settings, there is an option, which is <strong>Send text at start</strong>. This is essentially a command we can run when someone starts up iTerm2. This is saved in iTerm2&rsquo;s preferences, which can be found at <code>~/Library/Preferences/com.googlecode.iterm2.plist</code>.</p>
<p>This is a binary PLIST, and we can use <code>plutil</code> to convert it to XML format.</p>
<pre tabindex="0"><code>csaby@mac ~ % plutil -convert xml1 ~/Library/Preferences/com.googlecode.iterm2.plist -o - | grep -A 1 &quot;Initial Text&quot;
			&lt;key&gt;Initial Text&lt;/key&gt;
			&lt;string&gt;whoami&lt;/string&gt;
--
			&lt;key&gt;Initial Text&lt;/key&gt;
			&lt;string&gt;uname&lt;/string&gt;
</code></pre><p>The command is saved under the <strong>Initail Text</strong> key, and there can be multiple for different profiles. We can also use the <code>defaults</code> command to get this data.</p>
<pre tabindex="0"><code>csaby@mac ~ % defaults read com.googlecode.iterm2 | grep Initial
            &quot;Initial Text&quot; = whoami;
            &quot;Initial Text&quot; = uname;
</code></pre><p>Beyond persisting, <code>iTerm2</code> can have plenty of TCC exception if it receives user consent.</p>
<pre tabindex="0"><code>Executable=/Applications/iTerm.app/Contents/MacOS/iTerm2
Identifier=com.googlecode.iterm2
Format=app bundle with Mach-O universal (x86_64 arm64)
CodeDirectory v=20500 size=140993 flags=0x10000(runtime) hashes=4395+7 location=embedded
Signature size=8978
Timestamp=2021. Feb 8. 7:27:16
Info.plist entries=51
TeamIdentifier=H7V7XYVQ7D
Runtime Version=11.1.0
Sealed Resources version=2 rules=13 files=318
Internal requirements count=1 size=216
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
	&lt;key&gt;com.apple.security.automation.apple-events&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.cs.allow-jit&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.device.audio-input&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.device.camera&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.personal-information.addressbook&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.personal-information.calendars&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.personal-information.location&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;com.apple.security.personal-information.photos-library&lt;/key&gt;
	&lt;true/&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre><p>As we can find in its entitlements, it can have access to camera, microphone, and several sensitive folders. Thus if access was granted by the user, we could access the same information with our persisted command.</p>
<p>Beyond this iTerm2 supports various auto launch scripts.</p>
<p>Scripts placed inside <code>~/Library/Application Support/iTerm2/Scripts/AutoLaunch</code> will be automatically launched upon starting iTerm. More information: <a href="https://iterm2.com/python-api/tutorial/daemons.html">Daemons — iTerm2 Python API 0.26 documentation</a></p>
<p>The file <code>~/Library/Application Support/iTerm2/Scripts/AutoLaunch.scpt</code> is also checked at startup, and it will be executed. This should be an Apple Script. More information: <a href="https://iterm2.com/documentation-scripting.html">Scripting - Documentation - iTerm2 - macOS Terminal Replacement</a></p>

      </div>

      <footer>
        


        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
     © 2021
    
       · 
      Blog created by <a href="https://twitter.com/theevilbit">@theevilbit</a>.
    
    
  </section>
</footer>

    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-151008930-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>

</html>
